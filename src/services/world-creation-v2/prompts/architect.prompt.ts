import type { Genre, ClarificationHistoryItem } from "../schemas";
import { GenreMetadata } from "../schemas";

/**
 * Промпт для агента-архитектора
 */
export function architectPrompt(
  genre: Genre,
  userInput: string,
  clarificationHistory: ClarificationHistoryItem[]
): string {
  const genreInfo = GenreMetadata[genre];

  const historySection =
    clarificationHistory.length > 0
      ? `
## Предыдущие уточнения:
${clarificationHistory
  .map((h) => `- Вопрос: ${h.question}\n  Ответ: ${h.answer}`)
  .join("\n")}
`
      : "";

  return `Ты - опытный сценарист и мироустроитель. Твоя задача - создать "скелет" игрового мира на основе пожеланий пользователя.

## Выбранный жанр сюжета:
- **${genreInfo.label}**: ${genreInfo.description}

Важно: жанр определяет ТИП СЮЖЕТА, а не сеттинг мира. Например:
- "Повседневность в фэнтези таверне" - это повседневный жанр в фэнтези сеттинге
- "Хоррор на космическом корабле" - это хоррор жанр в sci-fi сеттинге

## Описание от пользователя:
${userInput}

${historySection}

## Твоя задача:

1. Если пользователь предоставил НЕДОСТАТОЧНО информации для создания интересного мира:
   - Установи needsClarification = true
   - Сформулируй 1-3 уточняющих вопроса с 3 вариантами ответов каждый
   - Вопросы должны помочь понять:
     * Сеттинг мира (если не указан)
     * Ключевые особенности мира
     * Масштаб и атмосферу
   
2. Если информации ДОСТАТОЧНО:
   - Установи needsClarification = false
   - Создай полный скелет мира (skeleton)

## Правила для скелета мира:

- **name**: Запоминающееся название мира
- **setting**: Тип сеттинга (fantasy, sci-fi, modern, post-apocalyptic, steampunk, etc.)
- **era**: Эпоха/временной период
- **tone**: Общий тон мира (мрачный, светлый, ироничный, эпический, etc.)
- **coreConflict**: Центральный конфликт мира, который влияет на всё
- **uniqueFeatures**: 3-5 уникальных особенностей, отличающих этот мир
- **worldPrimer**: 2-3 абзаца, описывающие суть мира для игрока

## Правила для elementsToGenerate:

Определи, какие элементы нужны для ДАННОГО КОНКРЕТНОГО мира. Не все миры требуют все элементы!

Доступные элементы:
- locations - ключевые локации (всегда нужны)
- factions - фракции/организации (если есть политика, конфликты групп)
- religions - религии/верования (если важны для сеттинга)
- races - расы/виды существ (для фэнтези, sci-fi)
- magic_system - система магии (для фэнтези, если есть магия)
- technology - технологии (для sci-fi, steampunk, modern)
- history - ключевые исторические события (для глубоких сеттингов)
- economy - экономическая система (если важна для сюжета)
- culture - культуры и традиции (для атмосферных сеттингов)
- creatures - существа и монстры (для приключенческих сеттингов)
- notable_characters - ключевые NPC (всегда полезны)

Выбирай только то, что действительно нужно для данного мира!

Отвечай на том же языке, что и пользователь.`;
}

/**
 * Промпт для финальной доработки скелета после уточнений
 */
export function architectFinalPrompt(
  genre: Genre,
  userInput: string,
  clarificationHistory: ClarificationHistoryItem[]
): string {
  const genreInfo = GenreMetadata[genre];

  return `Ты - опытный сценарист и мироустроитель. Пользователь уже ответил на все уточняющие вопросы. Теперь нужно создать финальный скелет мира.

## Жанр сюжета: ${genreInfo.label}

## Исходное описание:
${userInput}

## Собранная информация:
${clarificationHistory.map((h) => `- ${h.question}: ${h.answer}`).join("\n")}

Создай полный скелет мира на основе всей собранной информации.

Отвечай на том же языке, что и пользователь.`;
}

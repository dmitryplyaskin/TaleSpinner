# World Architect: –ü–ª–∞–Ω –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

–≠—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç-–ø–ª–∞–Ω –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã **"World Architect"** ‚Äî —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è –º–∏—Ä–æ–≤ —Å –∞–≥–µ–Ω—Ç–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤ –∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º "–°–∫–µ–ª–µ—Ç–∞" –º–∏—Ä–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### Backend

1. **–°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö** (`src/services/world-creation/agents/schemas.ts`):
   - `GenerationConfigSchema` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –º–æ–¥—É–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
   - `WorldSkeletonSchema` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ "—á–µ—Ä–Ω–æ–≤–∏–∫–∞" –º–∏—Ä–∞
   - `ArchitectQuestionSchema` ‚Äî –≤–æ–ø—Ä–æ—Å—ã —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤
   - `ArchitectResponseSchema` ‚Äî –æ—Ç–≤–µ—Ç –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞

2. **Architect Agent** (`src/services/world-creation/agents/architect.agent.ts`):
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–Ω–ø—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–µ—Ç—Ç–∏–Ω–≥
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –º–æ–¥—É–ª–∏ –Ω—É–∂–Ω—ã (–º–∞–≥–∏—è, —Ñ—Ä–∞–∫—Ü–∏–∏, —Ä–∞—Å—ã –∏ —Ç.–¥.)
   - –õ–∏–±–æ –∑–∞–¥–∞–µ—Ç —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã —Å –æ–ø—Ü–∏—è–º–∏, –ª–∏–±–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –°–∫–µ–ª–µ—Ç

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ State** (`src/services/world-creation/graph/state.ts`):
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `skeleton` –∏ `config` –≤ –≥—Ä–∞—Ñ

4. **Architect Node** (`src/services/world-creation/graph/nodes/architect.node.ts`):
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç Architect Agent –≤ —Ü–∏–∫–ª–µ
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ HITL (Human-in-the-Loop)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –°–∫–µ–ª–µ—Ç–∞ —á–µ—Ä–µ–∑ HITL
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ü–∏–∫–ª "–ü—Ä–∞–≤–∫–∞ ‚Äî –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ"

5. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —É–∑–ª—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**:
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã `factions.node.ts`, `locations.node.ts`, `races.node.ts`, `history.node.ts`, `magic.node.ts`
   - –ö–∞–∂–¥—ã–π —É–∑–µ–ª –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `state.config` –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é, –µ—Å–ª–∏ –º–æ–¥—É–ª—å –≤—ã–∫–ª—é—á–µ–Ω

6. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞** (`src/services/world-creation/graph/world-generation.graph.ts`):
   - –î–æ–±–∞–≤–ª–µ–Ω `architectNode` –∫–∞–∫ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞
   - –ì—Ä–∞—Ñ —Ç–µ–ø–µ—Ä—å: `START ‚Üí architect ‚Üí base ‚Üí parallel(factions, locations, races) ‚Üí history ‚Üí magic ‚Üí review`

### Frontend

7. **QuestionForm** (`frontend/src/features/world-creation/ui/steps/question-form.tsx`):
   - –ü–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º `ClarificationRequest`
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `radio`, `multiselect`, `textarea`, `text`
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –ø–æ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞

8. **SkeletonPreview** (`frontend/src/features/world-creation/ui/steps/skeleton-preview.tsx`):
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç "–ü–∞—Å–ø–æ—Ä—Ç –ú–∏—Ä–∞"
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –º–æ–¥—É–ª–∏ (Switch –¥–ª—è –∫–∞–∂–¥–æ–≥–æ)
   - –ü–æ–ª–µ –¥–ª—è feedback/–ø—Ä–∞–≤–æ–∫
   - –ö–Ω–æ–ø–∫–∏ "–£—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" / "–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –°–∫–µ–ª–µ—Ç"

---

## üî® –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### 1. Backend: API Endpoints ‚úÖ

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ** ‚Äî –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã:
- ‚úÖ `/world-creation/agent/start` ‚Äî —Å—Ç–∞—Ä—Ç —Å–µ—Å—Å–∏–∏
- ‚úÖ `/world-creation/agent/analyze` ‚Äî –∞–Ω–∞–ª–∏–∑ –∏–Ω–ø—É—Ç–∞
- ‚úÖ `/world-creation/agent/generate/:sessionId/stream` ‚Äî SSE stream —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π HITL
- ‚úÖ `/world-creation/agent/generate/:sessionId/continue` ‚Äî –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ì—Ä–∞—Ñ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å architect node –∫–∞–∫ —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞

### 2. Frontend: –õ–æ–≥–∏–∫–∞ Wizard ‚úÖ

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ**:
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `clarification-utils.ts` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
   - `isSkeletonApprovalRequest()` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–∫–µ–ª–µ—Ç–∞
   - `isArchitectQuestions()` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `wizard.tsx`:
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `$clarificationRequest` –∏ `SkeletonPreview`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `init.ts`:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `continueGenerationFx.doneData`
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ –ø—Ä–∏ HITL
4. ‚úÖ –°–æ–∑–¥–∞–Ω `sse.ts` –¥–ª—è SSE streaming

### 3. Frontend: Wizard Component Integration ‚úÖ

**–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ**:
- ‚úÖ `SkeletonPreview` –¥–æ–±–∞–≤–ª–µ–Ω –≤ wizard
- ‚úÖ `QuestionForm` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ–ª–µ–π
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞:
  ```tsx
  {step === 'questions' && (
    clarificationRequest ? (
      isSkeletonApprovalRequest(clarificationRequest) ? (
        <SkeletonPreview />
      ) : (
        <QuestionForm />
      )
    ) : <Loading />
  )}
  ```

---

## üß™ –û—Å—Ç–∞–ª–æ—Å—å: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:

1. **–°—Ü–µ–Ω–∞—Ä–∏–π 1: High Fantasy**
   - –°–µ—Ç—Ç–∏–Ω–≥: Fantasy
   - –ò–Ω–ø—É—Ç: "–ú—Ä–∞—á–Ω—ã–π –º–∏—Ä —Å –º–∞–≥–∏–µ–π –∫—Ä–æ–≤–∏ –∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏–Ω—Ç—Ä–∏–≥–∞–º–∏ —ç–ª—å—Ñ–∏–π—Å–∫–∏—Ö –∫–ª–∞–Ω–æ–≤"
   - –û–∂–∏–¥–∞–Ω–∏–µ:
     - –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Å—Ä–∞–∑—É –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –°–∫–µ–ª–µ—Ç
     - –í—Å–µ –º–æ–¥—É–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã (`hasMagic`, `hasFactions`, `hasRaces`)
     - –ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –º–æ–¥—É–ª–∏

2. **–°—Ü–µ–Ω–∞—Ä–∏–π 2: Slice-of-Life**
   - –°–µ—Ç—Ç–∏–Ω–≥: Contemporary
   - –ò–Ω–ø—É—Ç: "–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è –∂–∏–∑–Ω—å –≤ —è–ø–æ–Ω—Å–∫–æ–π —à–∫–æ–ª–µ, —Ä–æ–º–∞–Ω—Ç–∏–∫–∞"
   - –û–∂–∏–¥–∞–Ω–∏–µ:
     - –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –°–∫–µ–ª–µ—Ç —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ `hasMagic`, `hasRaces`, `hasFactions`
     - –¢–æ–ª—å–∫–æ `hasLocations` –∏ `hasCharacters` –≤–∫–ª—é—á–µ–Ω—ã
     - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∑–ª—ã –º–∞–≥–∏–∏/—Ä–∞—Å/—Ñ—Ä–∞–∫—Ü–∏–π

3. **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**
   - –°–µ—Ç—Ç–∏–Ω–≥: Sci-Fi
   - –ò–Ω–ø—É—Ç: "–ö–æ—Å–º–æ—Å"
   - –û–∂–∏–¥–∞–Ω–∏–µ:
     - –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏:
       - "–ö–∞–∫–æ–π —Ç–∏–ø –∫–æ—Å–º–æ—Å–∞?" ‚Üí [Hard Sci-Fi, Space Opera, Cyberpunk]
       - "–ï—Å—Ç—å –ª–∏ –ø—Ä–∏—à–µ–ª—å—Ü—ã?" ‚Üí [–î–∞, –º–Ω–æ–≥–æ —Ä–∞—Å / –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –ª—é–¥–∏ / –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç]
     - –ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–æ–≤ ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –°–∫–µ–ª–µ—Ç
     - –ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

4. **–°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–∞–≤–∫–∞ –°–∫–µ–ª–µ—Ç–∞**
   - –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –°–∫–µ–ª–µ—Ç–∞ —é–∑–µ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –°–∫–µ–ª–µ—Ç"
   - –ü–∏—à–µ—Ç feedback: "–°–¥–µ–ª–∞–π –º–∏—Ä –±–æ–ª–µ–µ –º—Ä–∞—á–Ω—ã–º, –¥–æ–±–∞–≤—å –±–æ–ª—å—à–µ –ø–æ–ª–∏—Ç–∏–∫–∏"
   - –û–∂–∏–¥–∞–Ω–∏–µ:
     - –ì—Ä–∞—Ñ –≤–µ—Ä–Ω–µ—Ç—Å—è –≤ Architect
     - –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –°–∫–µ–ª–µ—Ç —Å —É—á–µ—Ç–æ–º feedback
     - –°–Ω–æ–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è SkeletonPreview

### 5. API Routes (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–§–∞–π–ª**: `src/api/world-creation/agent.routes.ts` (–∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–π)

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∞—Ä—à—Ä—É—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç:
- `POST /world-creation/agent/start` ‚Üí `AgentWorldService.startSession()`
- `POST /world-creation/agent/analyze` ‚Üí `AgentWorldService.analyzeInput()` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- `POST /world-creation/agent/continue` ‚Üí `AgentWorldService.continueGeneration()`
- `GET /world-creation/agent/generate-stream/:sessionId` ‚Üí SSE stream

---

## –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] Backend: Architect Agent –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞–ø–∏—Ç –∂–∞–Ω—Ä—ã –Ω–∞ –∫–æ–Ω—Ñ–∏–≥–∏
- [ ] Backend: –ì—Ä–∞—Ñ–∏–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç interrupt –æ—Ç Architect
- [ ] Backend: –£–∑–ª—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è, –µ—Å–ª–∏ –º–æ–¥—É–ª—å –≤—ã–∫–ª—é—á–µ–Ω
- [ ] Frontend: QuestionForm —Ä–µ–Ω–¥–µ—Ä–∏—Ç radio/multiselect/textarea
- [ ] Frontend: SkeletonPreview –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω—É–∂–Ω–æ–º —Ç–∏–ø–µ ClarificationRequest
- [ ] Frontend: Wizard –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É QuestionForm –∏ SkeletonPreview
- [ ] Frontend: –ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –°–∫–µ–ª–µ—Ç–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- [ ] Testing: –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ 4 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è
- [ ] UX: –í—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º (–µ—Å–ª–∏ outputLanguage=ru)

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ì–∏–±–∫–æ—Å—Ç—å –ø–æ –∂–∞–Ω—Ä–∞–º**: –°–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –ª—é–±–æ–π —Å–µ—Ç—Ç–∏–Ω–≥, –æ—Ç high fantasy –¥–æ slice-of-life
2. **–°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏**: –í–º–µ—Å—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
3. **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –î–û –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
4. **–ö–æ–Ω—Ç—Ä–æ–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**: –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ –º–æ–¥—É–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞–≥–∏—é –≤ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–º –º–∏—Ä–µ)
5. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ**: –¶–∏–∫–ª "–°–∫–µ–ª–µ—Ç ‚Üí –ü—Ä–∞–≤–∫–∏ ‚Üí –°–∫–µ–ª–µ—Ç" –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Ü–µ–ø—Ç –¥–æ –∏–¥–µ–∞–ª–∞

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ì—Ä–∞—Ñ-—Ñ–ª–æ—É (–Ω–æ–≤—ã–π)

```mermaid
graph TD
    Start[START] --> Architect[Architect Node]
    
    Architect -->|–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö| Questions[HITL: Questions]
    Questions -->|–û—Ç–≤–µ—Ç—ã —é–∑–µ—Ä–∞| Architect
    
    Architect -->|–î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å| Skeleton[HITL: Skeleton Approval]
    
    Skeleton -->|–ü—Ä–∞–≤–∫–∏| Architect
    Skeleton -->|–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ| Base[Generate Base]
    
    Base --> Router{Config Router}
    
    Router -->|hasFactions=true| Factions[Generate Factions]
    Router -->|hasLocations=true| Locations[Generate Locations]
    Router -->|hasRaces=true| Races[Generate Races]
    
    Factions --> History
    Locations --> History
    Races --> History
    
    History -->|hasMagic=true| Magic[Generate Magic]
    History -->|hasMagic=false| Review
    
    Magic --> Review[Review World]
    Review -->|–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã| Refine[Refine World]
    Refine --> Review
    Review -->|OK| End[END]
```

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

1. **State —Ä–∞—Å—à–∏—Ä–µ–Ω**:
   ```typescript
   skeleton: WorldSkeleton | null
   config: GenerationConfig | null
   ```

2. **–£–∑–ª—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç config**:
   ```typescript
   if (state.config && !state.config.hasFactions) {
     return { currentNode: "generateFactions" }; // Skip
   }
   ```

3. **Architect –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏–±–æ –≤–æ–ø—Ä–æ—Å—ã, –ª–∏–±–æ —Å–∫–µ–ª–µ—Ç**:
   ```typescript
   {
     is_ready: boolean,
     questions?: ArchitectQuestion[],
     skeleton?: WorldSkeleton
   }
   ```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–¥–ª—è –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞)

1. **‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Wizard**: –í–´–ü–û–õ–ù–ï–ù–û - SkeletonPreview –∏ QuestionForm –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
2. **üß™ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ 4 —Å—Ü–µ–Ω–∞—Ä–∏—è
3. **üîß –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã**: –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Å—Ç–æ–≤ —É–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞
4. **üìö –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏–º–µ—Ä—ã –º–∏—Ä–æ–≤ –¥–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è
5. **üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å SSE –≤ GenerationProgress**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `startGenerationStream` –¥–ª—è real-time updates

---

**–°—Ç–∞—Ç—É—Å**: Backend –≥–æ—Ç–æ–≤ –Ω–∞ **100%**, Frontend –≥–æ—Ç–æ–≤ –Ω–∞ **95%**. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ–ª–∫–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç–µ—Å—Ç–æ–≤.

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥:**
   ```bash
   cd c:\pet_projects\TaleSpinner
   npm run dev
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:**
   ```bash
   cd c:\pet_projects\TaleSpinner\frontend
   npm run dev
   ```

3. **–û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä** –∏ –Ω–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏—Ä–∞

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **SSE –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** - –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ —à–∞–≥–µ "questions", –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. **ArchitectNode –º–æ–∂–µ—Ç –∑–∞—Ü–∏–∫–ª–∏—Ç—å—Å—è** - –µ—Å—Ç—å MAX_ITERATIONS=5, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
3. **–ú–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å—Å—è** - –µ—Å–ª–∏ config.hasFactions=false, –Ω–æ —Ñ—Ä–∞–∫—Ü–∏–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É —É–∑–ª–æ–≤

---

**–ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ!** üöÄ
